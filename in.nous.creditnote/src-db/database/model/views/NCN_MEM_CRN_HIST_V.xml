<?xml version="1.0"?>
  <database name="VIEW NCN_MEM_CRN_HIST_V">
    <view name="NCN_MEM_CRN_HIST_V"><![CDATA[SELECT DISTINCT inv.c_invoice_id AS ncn_mem_crn_hist_v_id, inv.ad_client_id, inv.ad_org_id, inv.isactive, inv.created, inv.createdby, inv.updated, inv.updatedby, inv.issotrx, inv.documentno, inv.docstatus, inv.processed, inv.c_doctype_id, inv.dateinvoiced, inv.c_order_id, inv.c_bpartner_id, inv.c_bpartner_location_id, inv.c_currency_id, inv.totallines, inv.grandtotal, rr.name AS return_reason, (SELECT m_transaction.m_locator_id FROM m_transaction WHERE m_transaction.em_sw_documentno = inv.documentno AND m_transaction.m_product_id = invl.m_product_id AND m_transaction.movementtype = 'M-' LIMIT 1) AS fromlocator_id, (SELECT m_transaction.m_locator_id FROM m_transaction WHERE m_transaction.em_sw_documentno = inv.documentno AND m_transaction.m_product_id = invl.m_product_id AND m_transaction.movementtype = 'M+' LIMIT 1) AS tolocator_id FROM c_invoice inv JOIN c_invoiceline invl ON invl.c_invoice_id = inv.c_invoice_id JOIN c_order o ON o.c_order_id = inv.c_order_id JOIN m_inout io ON io.c_order_id = o.c_order_id JOIN c_return_reason rr ON rr.c_return_reason_id = o.c_return_reason_id WHERE inv.issotrx = 'Y' AND o.issotrx = 'Y' AND io.issotrx = 'Y' AND inv.documentno LIKE 'CRN-%' AND (inv.docstatus IN ('CO', 'CL')) AND inv.processed = 'Y' ORDER BY inv.documentno]]></view>
  </database>
