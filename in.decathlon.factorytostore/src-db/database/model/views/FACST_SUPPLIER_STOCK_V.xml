<?xml version="1.0"?>
  <database name="VIEW FACST_SUPPLIER_STOCK_V">
    <view name="FACST_SUPPLIER_STOCK_V"><![CDATA[SELECT detail.m_storage_detail_id AS facst_supplier_stock_v_id, detail.ad_client_id, detail.ad_org_id, detail.isactive, detail.created, detail.createdby, detail.updated, detail.updatedby, detail.m_product_id AS product, detail.m_locator_id AS storagebin, detail.m_attributesetinstance_id AS attributesetvalue, detail.qtyonhand AS quantityonhand, COALESCE(rs.reservedqty, 0) AS reservedqty, COALESCE(detail.qtyonhand, 0) - COALESCE(rs.reservedqty, 0) AS availableqty, w.name AS warehouse FROM m_storage_detail detail JOIN m_locator loc ON loc.m_locator_id = detail.m_locator_id JOIN m_warehouse w ON w.m_warehouse_id = loc.m_warehouse_id JOIN m_product prod ON prod.m_product_id = detail.m_product_id LEFT JOIN (SELECT sum(stock.quantity) - sum(stock.releasedqty) AS reservedqty, stock.m_locator_id, rev.m_product_id, stock.m_attributesetinstance_id FROM m_reservation rev JOIN m_reservation_stock stock ON stock.m_reservation_id = rev.m_reservation_id JOIN m_locator loc ON loc.m_locator_id = stock.m_locator_id JOIN m_warehouse w ON w.m_warehouse_id = loc.m_warehouse_id JOIN m_product m ON rev.m_product_id = m.m_product_id JOIN m_attributesetinstance att ON stock.m_attributesetinstance_id = att.m_attributesetinstance_id WHERE rev.res_status = 'CO' AND loc.em_obwhs_type = 'ST' AND w.em_ibdo_warehousetype = 'FACST_External' GROUP BY stock.m_locator_id, rev.m_product_id, stock.m_attributesetinstance_id) rs ON rs.m_locator_id = detail.m_locator_id AND rs.m_attributesetinstance_id = detail.m_attributesetinstance_id AND rs.m_product_id = detail.m_product_id WHERE w.em_ibdo_warehousetype = 'FACST_External' AND loc.em_obwhs_type = 'ST']]></view>
  </database>
